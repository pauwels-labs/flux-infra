apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../vault
patches:
- patch: |-
    - op: replace
      path: /spec/values/server/ha/apiAddr
      value: "http://$(HOSTNAME).vault-internal.i-vault.svc.cluster.local:8200"
    - op: replace
      path: /spec/values/server/ha/clusterAddr
      value: "http://$(HOSTNAME).vault-internal.i-vault.svc.cluster.local:8201"
    - op: replace
      path: /spec/targetNamespace
      value: "i-vault"
    - op: replace
      path: /metadata/name
      value: vault2
  target:
    kind: HelmRelease
    name: vault
    namespace: flux-system
- patch: |-
    - op: replace
      path: /metadata/name
      value: i-vault
    - op: replace
      path: /metadata/labels/name
      value: i-vault
  target:
    kind: Namespace
    name: vault
- patch: |-
    - op: replace
      path: /metadata/namespace
      value: i-vault
  target:
    kind: PeerAuthentication
    name: strict
